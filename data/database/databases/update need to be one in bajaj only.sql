ALTER TABLE HRIS_EMPLOYEE_TRAVEL_REQUEST MODIFY( REQUESTED_AMOUNT NULL); 


CREATE TABLE HRIS_PREFERENCES
  (
    KEY   VARCHAR2(100 BYTE) PRIMARY KEY,
    VALUE VARCHAR2(100 BYTE)
  );


ALTER TABLE HRIS_EMPLOYEE_SHIFT_ASSIGN ADD START_DATE DATE DEFAULT TO_DATE('16-JUL-2017','DD-MON-YYYY') NOT NULL;

ALTER TABLE HRIS_EMPLOYEE_SHIFT_ASSIGN ADD END_DATE DATE ;

ALTER TABLE HRIS_EMPLOYEE_SHIFT_ASSIGN ADD ID NUMBER(7,0);


ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD ENABLE_SUBSTITUTE CHAR(1 BYTE) DEFAULT 'Y' NOT NULL CHECK(ENABLE_SUBSTITUTE IN ('Y','N'));


ALTER TABLE HRIS_EMPLOYEES
DROP CONSTRAINT EMP_EMAIL_OFF_UN;


--
ALTER TABLE HRIS_EMPLOYEES
DROP CONSTRAINT EMP_EMAIL_PER_UN;


ALTER TABLE HRIS_JOB_HISTORY ADD RETIRED_FLAG CHAR(1 BYTE) DEFAULT 'N' NOT NULL CHECK(RETIRED_FLAG IN ('Y','N'));


--
ALTER TABLE HRIS_JOB_HISTORY ADD DISABLED_FLAG CHAR(1 BYTE) DEFAULT 'N' NOT NULL CHECK(DISABLED_FLAG IN ('Y','N'));
-- 
ALTER TABLE HRIS_JOB_HISTORY ADD EVENT_DATE DATE DEFAULT SYSDATE NOT NULL;

ALTER TABLE HRIS_ROLES ADD CONTROL CHAR(1 BYTE) DEFAULT 'F' NOT NULL CHECK(CONTROL IN ('F','C','U'));

ALTER TABLE HRIS_ROLES ADD ALLOW_ADD CHAR(1 BYTE) DEFAULT 'Y' NOT NULL CHECK(ALLOW_ADD IN ('Y','N'));

ALTER TABLE HRIS_ROLES ADD ALLOW_UPDATE CHAR(1 BYTE) DEFAULT 'Y' NOT NULL CHECK(ALLOW_UPDATE IN ('Y','N'));

ALTER TABLE HRIS_ROLES ADD ALLOW_DELETE CHAR(1 BYTE) DEFAULT 'Y' NOT NULL CHECK(ALLOW_DELETE IN ('Y','N'));

  CREATE TABLE "HRIS_EMPLOYEE_PENALTY_DAYS" 
   (	"EMPLOYEE_ID" NUMBER(7,0), 
	"ATTENDANCE_DT" DATE
   )

CREATE TABLE HRIS_EMPLOYEE_SHIFT_ROASTER
  (
    EMPLOYEE_ID NUMBER(7,0),
    SHIFT_ID    NUMBER(7,0),
    FOR_DATE    DATE NOT NULL,
    CREATED_BY  NUMBER(7,0),
    MODIFIED_BY NUMBER(7,0),
    CREATED_DT  NUMBER(7,0),
    MODIFED_DT  NUMBER(7,0),
    CONSTRAINT FK_ROASTER_EMPLOYEE_EMP_ID FOREIGN KEY(EMPLOYEE_ID) REFERENCES HRIS_EMPLOYEES(EMPLOYEE_ID),
    CONSTRAINT FK_ROASTER_SHIFT_SHIFT_ID FOREIGN KEY(SHIFT_ID) REFERENCES HRIS_SHIFTS(SHIFT_ID)
  );


-- HRIS_PRELOAD_ATTENANCE PROCEDURE IS CHANGED
ALTER TABLE HRIS_USERS ADD IS_LOCKED CHAR(1 BYTE) DEFAULT ('N') NOT NULL;

ALTER TABLE HRIS_ATTENDANCE_REQUEST
MODIFY IN_TIME NULL;

ALTER TABLE HRIS_ATTENDANCE_REQUEST
MODIFY OUT_TIME NULL;



CREATE TABLE HRIS_EMPLOYEE_SHIFTS
  (
    EMPLOYEE_ID NUMBER(7,0),
    SHIFT_ID    NUMBER(7,0),
    START_DATE  DATE,
    END_DATE    DATE
  );



CREATE TABLE HRIS_EMPLOYEE_LEAVE_ADDITION
  (
    EMPLOYEE_ID NUMBER(7,0),
    LEAVE_ID    NUMBER(7,0),
    NO_OF_DAYS FLOAT,
    REMARKS      VARCHAR2(512 BYTE),
    CREATED_DATE DATE,
    WOD_ID NUMBER(7,0),
    WOH_ID NUMBER(7,0)
  );



DROP TABLE HRIS_EMPLOYEE_PENALTY_DAYS;
--
CREATE TABLE HRIS_EMPLOYEE_PENALTY_DAYS
  (
    EMPLOYEE_ID   NUMBER(7,0),
    ATTENDANCE_DT DATE,
    LEAVE_ID      NUMBER(7,0),
    NO_OF_DAYS FLOAT,
    REMARKS      VARCHAR2(512 BYTE),
    CREATED_DATE DATE
  );

ALTER TABLE HRIS_ATTENDANCE_DETAIL ADD GRACE_PERIOD   CHAR(1 BYTE) DEFAULT NULL CHECK(GRACE_PERIOD   IN ('E','L'));
ALTER TABLE HRIS_ATTENDANCE_DETAIL ADD HALFDAY_PERIOD CHAR(1 BYTE) DEFAULT NULL CHECK(HALFDAY_PERIOD IN ('F','S'));



ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD DEDUCTION_PRIORITY_NO NUMBER(7,0);




ALTER TABLE HRIS_MONTH_CODE ADD YEAR NUMBER DEFAULT 2073 NOT NULL ;
ALTER TABLE HRIS_MONTH_CODE ADD MONTH_NO NUMBER DEFAULT 1 NOT NULL;


CREATE TABLE HRIS_PENALIZED_MONTHS
  (
    YEAR         NUMBER NOT NULL,
    MONTH_NO     NUMBER NOT NULL,
    NO_OF_DAYS   NUMBER NOT NULL,
    CREATED_DATE DATE,
    CREATED_BY NUMBER(7,0),
    MODIFIED_DATE DATE,
    MODIFIED_BY NUMBER(7,0)
  );



UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=1 WHERE MONTH_ID = 22;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=2 WHERE MONTH_ID = 23;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=3 WHERE MONTH_ID = 24;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=4 WHERE MONTH_ID = 25;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=5 WHERE MONTH_ID = 26;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=6 WHERE MONTH_ID = 27;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=7 WHERE MONTH_ID = 28;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=8 WHERE MONTH_ID = 29;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=9 WHERE MONTH_ID = 30;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=10 WHERE MONTH_ID = 31;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=11 WHERE MONTH_ID = 32;
UPDATE HRIS_MONTH_CODE SET YEAR = 2074,MONTH_NO=12 WHERE MONTH_ID = 33;
UPDATE HRIS_MONTH_CODE SET YEAR = 2075,MONTH_NO=1 WHERE MONTH_ID = 34;
UPDATE HRIS_MONTH_CODE SET YEAR = 2075,MONTH_NO=2 WHERE MONTH_ID = 35;
UPDATE HRIS_MONTH_CODE SET YEAR = 2075,MONTH_NO=3 WHERE MONTH_ID = 36;




ALTER TABLE HRIS_ATTENDANCE_DETAIL ADD WOD_ID NUMBER(7,0);
ALTER TABLE HRIS_ATTENDANCE_DETAIL ADD WOH_ID NUMBER(7,0);

-- HRIS_PRELOAD_ATTENDANCE
-- HRIS_REATTENDANCE
-- DEVICE_ATTENDANCE_TRIGGER

ALTER TABLE HRIS_ATTENDANCE_DETAIL ADD TWO_DAY_SHIFT CHAR(1 BYTE) DEFAULT 'D' NOT NULL CHECK(TWO_DAY_SHIFT IN ('E','D'));
-- HRIS_PRELOAD_ATTENDANCE
-- DEVICE_ATTENDANCE_TRIGGER
-- HRIS_REATTENDANCE
-- HRIS_REATTENDANCE_TWO_DAY


-- HRIS_RECALCULATE_LEAVE
-- HRIS_WOD_LEAVE_ADDITION
-- HRIS_WOD_OT_ADDITION
-- HRIS_WOH_LEAVE_ADDITION
-- HRIS_WOH_OT_ADDITION
-- HRIS_MENU_ROLE_ASSIGN ADDED

CREATE TABLE HRIS_POSITION_MONTHLY_VALUE
  (
    MTH_ID         NUMBER(7,0),
    POSITION_ID    NUMBER(7,0),
    MONTH_ID       NUMBER(7,0),
    ASSIGNED_VALUE NUMBER
  );
--
ALTER TABLE HRIS_MONTHLY_VALUE_SETUP
DROP COLUMN COMPANY_ID;
--
ALTER TABLE HRIS_MONTHLY_VALUE_SETUP
DROP COLUMN BRANCH_ID;
--
ALTER TABLE HRIS_MONTHLY_VALUE_SETUP
DROP COLUMN SHOW_AT_RULE;
--
ALTER TABLE HRIS_MONTHLY_VALUE_SETUP
DROP COLUMN SH_INDEX_NO;
--
ALTER TABLE HRIS_MONTHLY_VALUE_SETUP
ADD CREATED_BY NUMBER(7,0);
--
ALTER TABLE HRIS_MONTHLY_VALUE_SETUP
ADD MODIFIED_BY NUMBER(7,0);
--
ALTER TABLE HRIS_EMPLOYEE_LEAVE_REQUEST MODIFY( REMARKS VARCHAR2(255 ));

CREATE TABLE HRIS_HOLIDAY_ASSIGN
  (
    HOLIDAY_ID            NUMBER(7,0) NOT NULL,
    COMPANY_ID            NUMBER(7,0),
    BRANCH_ID             NUMBER(7,0),
    DEPARTMENT_ID         NUMBER(7,0),
    DESIGNATION_ID        NUMBER(7,0),
    POSITION_ID           NUMBER(7,0),
    SERVICE_TYPE_ID       NUMBER(7,0),
    SERVICE_EVENT_TYPE_ID NUMBER(7,0),
    EMPLOYEE_TYPE         CHAR(1 BYTE),
    GENDER_ID             NUMBER(7,0),
    EMPLOYEE_ID           NUMBER(7,0)
  );

-- HRIS_HOLIDAY_ASSIGN_AUTO PROCEDURE CREATED

ALTER TABLE HRIS_SALARY_SHEET ADD YEAR      NUMBER;
ALTER TABLE HRIS_SALARY_SHEET ADD MONTH_NO  NUMBER;
ALTER TABLE HRIS_SALARY_SHEET ADD START_DATE DATE;
ALTER TABLE HRIS_SALARY_SHEET ADD END_DATE   DATE;
ALTER TABLE HRIS_SALARY_SHEET_DETAIL DROP COLUMN MONTH_ID;
ALTER TABLE HRIS_SALARY_SHEET_DETAIL DROP COLUMN TOTAL_VAL;




ALTER TABLE HRIS_PAY_SETUP ADD IS_MONTHLY CHAR(1 BYTE) NOT NULL CHECK(IS_MONTHLY IN ('Y','N'));

ALTER TABLE HRIS_PAY_SETUP ADD FORMULA LONG NOT NULL;

DROP TABLE HRIS_PAY_DETAIL_SETUP;

DROP TABLE HRIS_PAY_EMPLOYEE_SETUP;

ALTER TABLE HRIS_PAY_SETUP DROP COLUMN REF_PAY_ID;

ALTER TABLE HRIS_PAY_SETUP DROP COLUMN REF_RULE_FLAG;

ALTER TABLE HRIS_PAY_SETUP DROP COLUMN COMPANY_ID;

ALTER TABLE HRIS_PAY_SETUP DROP COLUMN BRANCH_ID;


ALTER TABLE HRIS_FLAT_VALUE_SETUP DROP COLUMN SHOW_AT_RULE;
ALTER TABLE HRIS_FLAT_VALUE_SETUP DROP COLUMN FLAT_FORMULA;



ALTER TABLE HRIS_FLAT_VALUE_SETUP DROP COLUMN COMPANY_ID;

ALTER TABLE HRIS_FLAT_VALUE_SETUP DROP COLUMN BRANCH_ID;

ALTER TABLE HRIS_MONTHLY_VALUE_SETUP ADD REMARKS VARCHAR2(255 BYTE);

ALTER TABLE HRIS_FLAT_VALUE_SETUP MODIFY(FLAT_LDESC NULL);
ALTER TABLE HRIS_PAY_SETUP MODIFY(PAY_LDESC NULL);


CREATE TABLE HRIS_NEWS_TYPE
  (
    NEWS_TYPE_ID   NUMBER(7,0) PRIMARY KEY,
    NEWS_TYPE_DESC VARCHAR2(255) NOT NULL,
    UPLOAD_FLAG    CHAR(1 BYTE) DEFAULT 'Y' CHECK (UPLOAD_FLAG IN ('Y','N')),
    STATUS         CHAR(1 BYTE) DEFAULT 'E' CHECK(STATUS       IN ('E','D')),
    CREATED_DT     DATE DEFAULT TRUNC(SYSDATE) NOT NULL,
    CREATED_BY     NUMBER(7,0),
    MODIFIED_DT    DATE,
    MODIFIED_BY    NUMBER(7,0)
  );

INSERT
INTO HRIS_MENUS
  (
    MENU_CODE,
    MENU_ID,
    MENU_NAME,
    PARENT_MENU,
    MENU_DESCRIPTION,
    ROUTE,
    STATUS,
    CREATED_DT,
    MODIFIED_DT,
    ICON_CLASS,
    ACTION,
    MENU_INDEX,
    CREATED_BY,
    MODIFIED_BY,
    IS_VISIBLE
  )
  VALUES
  (
    'nto1',
    (SELECT MAX(menu_id)+1 FROM hris_menus
    ),
    'News Type',
    9,
    'News Type',
    'news-type',
    'E',
    TRUNC(SYSDATE),
    NULL,
    'fa fa-pencil',
    'index',
    15,NULL,
    NULL,
    'Y'
  );


ALTER TABLE HRIS_NEWS DROP COLUMN NEWS_TYPE;
ALTER TABLE HRIS_NEWS ADD NEWS_TYPE NUMBER(7,0);




CREATE TABLE HRIS_NEWS_FILE
  (
    NEWS_FILE_ID NUMBER(7,0) PRIMARY KEY,
    NEWS_ID      NUMBER(7,0) NOT NULL,
    FILE_PATH    VARCHAR2(255),
    STATUS       CHAR(1 BYTE) DEFAULT 'E' CHECK(STATUS IN ('E','D')),
    CREATED_DT   DATE DEFAULT TRUNC(SYSDATE) NOT NULL,
    CREATED_BY   NUMBER(7,0),
    MODIFIED_DT  DATE,
    MODIFIED_BY  NUMBER(7,0),
    REMARKS      VARCHAR2(255),
    FILE_NAME    VARCHAR2(255)
  );
ALTER TABLE HRIS_NEWS ADD NEWS_EXPIRY_DT DATE DEFAULT TRUNC(SYSDATE) NOT NULL;

CREATE TABLE HRIS_NEWS_TO
  (
    NEWS_ID               NUMBER(7,0),
    COMPANY_ID            NUMBER(7,0),
    BRANCH_ID             NUMBER(7,0),
    DEPARTMENT_ID         NUMBER(7,0),
    DESIGNATION_ID        NUMBER(7,0),
    POSITION_ID           NUMBER(7,0),
    SERVICE_TYPE_ID       NUMBER(7,0),
    SERVICE_EVENT_TYPE_ID NUMBER(7,0),
    EMPLOYEE_TYPE         CHAR(1 BYTE),
    GENDER_ID             NUMBER(7,0),
    EMPLOYEE_ID           NUMBER(7,0)
  );

ALTER TABLE HRIS_NEWS DROP COLUMN COMPANY_ID;

ALTER TABLE HRIS_NEWS DROP COLUMN BRANCH_ID;
ALTER TABLE HRIS_NEWS DROP COLUMN DEPARTMENT_ID;
ALTER TABLE HRIS_NEWS DROP COLUMN DESIGNATION_ID;

CREATE TABLE HRIS_NEWS_EMPLOYEE
  (NEWS_ID NUMBER(7,0),EMPLOYEE_ID NUMBER(7,0)
  );




ALTER TABLE HRIS_MONTH_CODE ADD FISCAL_YEAR_MONTH_NO NUMBER(2,0);

ALTER TABLE HRIS_COMPULSORY_OVERTIME ADD COMPULSORY_OT_DESC VARCHAR2(255 BYTE);

ALTER TABLE HRIS_SHIFTS ADD HALF_DAY_IN_TIME TIMESTAMP;

ALTER TABLE HRIS_SHIFTS ADD HALF_DAY_OUT_TIME TIMESTAMP;

ALTER TABLE HRIS_LEAVE_MASTER_SETUP DROP COLUMN COMPANY_ID ;
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD COMPANY_ID VARCHAR2(4000 BYTE);

ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD BRANCH_ID       VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD DEPARTMENT_ID   VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD DESIGNATION_ID  VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD POSITION_ID     VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD SERVICE_TYPE_ID VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD EMPLOYEE_TYPE   VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD GENDER_ID       VARCHAR2(4000 BYTE);
ALTER TABLE HRIS_LEAVE_MASTER_SETUP ADD EMPLOYEE_ID     VARCHAR2(4000 BYTE);




--run all procedure function and trigger--


-- drop all menus
--select * from hris_menus where lower(menu_name) like '%sal%';
--select * from hris_menus where lower(menu_name) like '%advance%';








insert into hris_menus
(
menu_id,
MENU_NAME,
PARENT_MENU,
route,
status,
created_dt,
icon_class,
action,
menu_index,
is_visible
)values
(
(select max(menu_id)+1 from hris_menus),
'Branch Wise Daily',
148,
'allreport',
'E',
TRUNC(SYSDATE),
'fa fa-pencil',
'branchWiseDaily',
(select max(MENU_INDEX)+1 from hris_menus where parent_menu=148),
'Y'
);


ALTER TABLE HRIS_ROLES MODIFY (CONTROL VARCHAR2(2 BYTE));